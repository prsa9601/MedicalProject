@page
@model MedicalProject.Pages.Front.ProjectsModel
@{
    ViewData["Title"] = "پروژه‌های سرمایه‌گذاری";
}

<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>پروژه‌های سرمایه‌گذاری - پلتفرم دنگ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Vazir', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f9fafb;
            color: #374151;
            line-height: 1.6;
            direction: rtl;
        }

        /* Utility Classes */
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .aspect-w-16 {
            position: relative;
        }

        .aspect-h-9 {
            padding-bottom: 56.25%;
        }

        .aspect-w-16 > * {
            position: absolute;
            height: 100%;
            width: 100%;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
        }

        .group:hover .group-hover-scale-105 {
            transform: scale(1.05);
        }

        .group:hover .group-hover-text-primary-600 {
            color: #2563eb;
        }

        .transition-transform {
            transition: transform 0.3s;
        }

        .transition-colors {
            transition: color 0.3s;
        }

        .transition-all {
            transition: all 0.3s;
        }

        .transition-shadow {
            transition: box-shadow 0.3s;
        }

        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @@keyframes pulse {
            0%, 100% {
                opacity: 1;
            }

            50% {
                opacity: .5;
            }
        }

        /* Layout */
        .min-h-screen {
            min-height: 100vh;
        }

        .max-w-7xl {
            max-width: 80rem;
        }

        .mx-auto {
            margin-right: auto;
            margin-left: auto;
        }

        .px-4 {
            padding-right: 1rem;
            padding-left: 1rem;
        }

        .py-8 {
            padding-top: 2rem;
            padding-bottom: 2rem;
        }

        /* Flexbox */
        .flex {
            display: flex;
        }

        .flex-col {
            flex-direction: column;
        }

        .flex-row {
            flex-direction: row;
        }

        .flex-1 {
            flex: 1 1 0%;
        }

        .justify-between {
            justify-content: space-between;
        }

        .justify-center {
            justify-content: center;
        }

        .items-start {
            align-items: flex-start;
        }

        .items-center {
            align-items: center;
        }

        /* Grid */
        .grid {
            display: grid;
        }

        .grid-cols-1 {
            grid-template-columns: repeat(1, minmax(0, 1fr));
        }

        .md-grid-cols-2 {
            grid-template-columns: repeat(2, minmax(0, 1fr));
        }

        .lg-grid-cols-3 {
            grid-template-columns: repeat(3, minmax(0, 1fr));
        }

        .gap-6 {
            gap: 1.5rem;
        }

        .gap-3 {
            gap: 0.75rem;
        }

        .gap-8 {
            gap: 2rem;
        }

        /* Spacing */
        .space-y-4 > * + * {
            margin-top: 1rem;
        }

        .space-y-2 > * + * {
            margin-top: 0.5rem;
        }

        .space-y-3 > * + * {
            margin-top: 0.75rem;
        }

        .space-y-6 > * + * {
            margin-top: 1.5rem;
        }

        .space-x-2 > * + * {
            margin-right: 0.5rem;
        }

        .space-x-reverse > * + * {
            margin-right: 0;
            margin-left: 0.5rem;
        }

        .mb-1 {
            margin-bottom: 0.25rem;
        }

        .mb-2 {
            margin-bottom: 0.5rem;
        }

        .mb-3 {
            margin-bottom: 0.75rem;
        }

        .mb-4 {
            margin-bottom: 1rem;
        }

        .mb-6 {
            margin-bottom: 1.5rem;
        }

        .mb-8 {
            margin-bottom: 2rem;
        }

        .mt-2 {
            margin-top: 0.5rem;
        }

        .mr-2 {
            margin-right: 0.5rem;
        }

        .ml-1 {
            margin-left: 0.25rem;
        }

        /* Sizing */
        .w-full {
            width: 100%;
        }

        .w-1\/4 {
            width: 25%;
        }

        .w-3\/4 {
            width: 75%;
        }

        .w-5 {
            width: 1.25rem;
        }

        .w-4 {
            width: 1rem;
        }

        .h-8 {
            height: 2rem;
        }

        .h-48 {
            height: 12rem;
        }

        .h-4 {
            height: 1rem;
        }

        .h-2 {
            height: 0.5rem;
        }

        .h-10 {
            height: 2.5rem;
        }

        .h-5 {
            height: 1.25rem;
        }

        /* Typography */
        .text-3xl {
            font-size: 1.875rem;
            line-height: 2.25rem;
        }

        .text-xl {
            font-size: 1.25rem;
            line-height: 1.75rem;
        }

        .text-lg {
            font-size: 1.125rem;
            line-height: 1.75rem;
        }

        .text-sm {
            font-size: 0.875rem;
            line-height: 1.25rem;
        }

        .text-xs {
            font-size: 0.75rem;
            line-height: 1rem;
        }

        .text-6xl {
            font-size: 3.75rem;
            line-height: 1;
        }

        .font-bold {
            font-weight: 700;
        }

        .font-semibold {
            font-weight: 600;
        }

        .font-medium {
            font-weight: 500;
        }

        .text-center {
            text-align: center;
        }

        .text-right {
            text-align: right;
        }

        .text-left {
            text-align: left;
        }

        /* Colors */
        .bg-gray-50 {
            background-color: #f9fafb;
        }

        .bg-gray-200 {
            background-color: #e5e7eb;
        }

        .bg-white {
            background-color: #ffffff;
        }

        .bg-primary-100 {
            background-color: #dbeafe;
        }

        .bg-primary-500 {
            background-color: #3b82f6;
        }

        .bg-primary-600 {
            background-color: #2563eb;
        }

        .bg-green-100 {
            background-color: #dcfce7;
        }

        .bg-blue-100 {
            background-color: #dbeafe;
        }

        .bg-red-100 {
            background-color: #fee2e2;
        }

        .bg-yellow-100 {
            background-color: #fef3c7;
        }

        .bg-gray-100 {
            background-color: #f3f4f6;
        }

        .text-gray-900 {
            color: #111827;
        }

        .text-gray-700 {
            color: #374151;
        }

        .text-gray-600 {
            color: #4b5563;
        }

        .text-gray-500 {
            color: #6b7280;
        }

        .text-gray-400 {
            color: #9ca3af;
        }

        .text-primary-600 {
            color: #2563eb;
        }

        .text-primary-700 {
            color: #1d4ed8;
        }

        .text-green-800 {
            color: #166534;
        }

        .text-blue-800 {
            color: #1e40af;
        }

        .text-red-800 {
            color: #991b1b;
        }

        .text-yellow-800 {
            color: #92400e;
        }

        .text-gray-800 {
            color: #1f2937;
        }

        .text-white {
            color: #ffffff;
        }

        /* Borders */
        .border {
            border-width: 1px;
        }

        .border-b {
            border-bottom-width: 1px;
        }

        .border-t {
            border-top-width: 1px;
        }

        .border-gray-200 {
            border-color: #e5e7eb;
        }

        .border-gray-300 {
            border-color: #d1d5db;
        }

        /* Border Radius */
        .rounded {
            border-radius: 0.25rem;
        }

        .rounded-lg {
            border-radius: 0.5rem;
        }

        .rounded-xl {
            border-radius: 0.75rem;
        }

        .rounded-full {
            border-radius: 9999px;
        }

        /* Shadows */
        .shadow-sm {
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }

        .shadow-md {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .hover-shadow-md:hover {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        /* Overflow */
        .overflow-hidden {
            overflow: hidden;
        }

        /* Position */
        .relative {
            position: relative;
        }

        .absolute {
            position: absolute;
        }

        .top-0 {
            top: 0;
        }

        .right-0 {
            right: 0;
        }

        .bottom-0 {
            bottom: 0;
        }

        .left-0 {
            left: 0;
        }

        .top-2 {
            top: 0.5rem;
        }

        .right-2 {
            right: 0.5rem;
        }

        .left-2 {
            left: 0.5rem;
        }

        .top-3 {
            top: 0.75rem;
        }

        .right-3 {
            right: 0.75rem;
        }

        /* Object Fit */
        .object-cover {
            object-fit: cover;
        }

        /* Background Gradient */
        .bg-gradient-to-br {
            background-image: linear-gradient(to bottom right, var(--tw-gradient-stops));
        }

        .from-blue-100 {
            --tw-gradient-from: #dbeafe;
            --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to, rgba(219, 234, 254, 0));
        }

        .to-blue-200 {
            --tw-gradient-to: #bfdbfe;
        }

        .from-primary-500 {
            --tw-gradient-from: #3b82f6;
            --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to, rgba(59, 130, 246, 0));
        }

        .to-primary-600 {
            --tw-gradient-to: #2563eb;
        }

        /* Focus States */
        .focus-ring-2:focus {
            outline: 2px solid transparent;
            outline-offset: 2px;
            box-shadow: 0 0 0 2px #3b82f6;
        }

        .focus-ring-primary-500:focus {
            box-shadow: 0 0 0 2px #3b82f6;
        }

        .focus-border-primary-500:focus {
            border-color: #3b82f6;
        }

        /* Hover States */
        .hover-bg-primary-700:hover {
            background-color: #1d4ed8;
        }

        .hover-bg-gray-100:hover {
            background-color: #f3f4f6;
        }

        .hover-bg-gray-50:hover {
            background-color: #f9fafb;
        }

        .hover-text-gray-600:hover {
            color: #4b5563;
        }

        /* Responsive */
        @@media (min-width: 768px) {
            .md-flex-row {
                flex-direction: row;
            }

            .md-items-center {
                align-items: center;
            }

            .md-space-y-0 > * + * {
                margin-top: 0;
            }
        }

        @@media (min-width: 1024px) {
            .lg-flex-row {
                flex-direction: row;
            }

            .lg-w-64 {
                width: 16rem;
            }
        }

        /* Custom Components */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.5rem 1rem;
            border: 1px solid transparent;
            font-size: 0.875rem;
            font-weight: 500;
            border-radius: 0.5rem;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            transition: all 0.2s;
            cursor: pointer;
        }

        .btn-primary {
            background-color: #2563eb;
            color: white;
        }

            .btn-primary:hover {
                background-color: #1d4ed8;
            }

        .btn-outline {
            border: 1px solid #d1d5db;
            color: #374151;
            background-color: white;
        }

            .btn-outline:hover {
                background-color: #f9fafb;
            }

        .card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            border: 1px solid #f3f4f6;
            overflow: hidden;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.625rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .badge-primary {
            background-color: #dbeafe;
            color: #1e40af;
        }

        .badge-success {
            background-color: #d1fae5;
            color: #065f46;
        }

        .badge-warning {
            background-color: #fef3c7;
            color: #92400e;
        }

        .badge-danger {
            background-color: #fee2e2;
            color: #991b1b;
        }

        .badge-secondary {
            background-color: #f3f4f6;
            color: #374151;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="min-h-screen bg-gray-50">
            <!-- Header -->
            <div class="bg-white shadow-sm border-b border-gray-200">
                <div class="max-w-7xl mx-auto px-4 py-8">
                    <div class="flex flex-col md-flex-row justify-between items-start md-items-center space-y-4 md-space-y-0">
                        <div>
                            <h1 class="text-3xl font-bold text-gray-900">پروژه‌های سرمایه‌گذاری</h1>
                            <p class="text-gray-600 mt-2" id="projects-count">
                                در حال بارگذاری...
                            </p>
                        </div>

                        <!-- View Mode Toggle -->
                        <div class="flex items-center space-x-2 space-x-reverse">
                            <button onclick="setViewMode('grid')"
                                    id="grid-view-btn"
                                    class="bg-primary-100 text-primary-600 p-2 rounded-lg">
                                <i class="fas fa-th w-5 h-5"></i>
                            </button>
                            <button onclick="setViewMode('list')"
                                    id="list-view-btn"
                                    class="text-gray-400 hover-text-gray-600 p-2 rounded-lg">
                                <i class="fas fa-list w-5 h-5"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="max-w-7xl mx-auto px-4 py-8">
                <div class="flex flex-col lg-flex-row gap-8">
                    <!-- Filters Sidebar -->
                    <div class="lg-w-64 space-y-6">
                        <!-- Search -->
                        <div class="bg-white rounded-lg shadow-sm p-4">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">جستجو</h3>
                            <div class="space-y-4">
                                <div class="relative">
                                    <input type="text"
                                           id="search-query"
                                           class="w-full p-2 pr-10 border border-gray-300 rounded-lg focus-ring-2 focus-ring-primary-500 focus-border-primary-500"
                                           placeholder="جستجو در پروژه‌ها..." />
                                    <i class="fas fa-search absolute right-3 top-3 text-gray-400"></i>
                                </div>
                                <button onclick="handleSearch()" class="w-full btn btn-primary">
                                    جستجو
                                </button>
                            </div>
                        </div>

                        <!-- Categories -->
                        <div class="bg-white rounded-lg shadow-sm p-4">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">دسته‌بندی‌ها</h3>
                            <div class="space-y-2">
                                <button onclick="setSelectedCategory(null)"
                                        id="all-categories-btn"
                                        class="bg-primary-100 text-primary-700 w-full text-right p-2 rounded-lg text-sm transition-colors">
                                    همه دسته‌ها
                                </button>
                                <div id="categories-list">
                                    <!-- Categories will be loaded here -->
                                </div>
                            </div>
                        </div>

                        <!-- Sort -->
                        <div class="bg-white rounded-lg shadow-sm p-4">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">مرتب‌سازی</h3>
                            <select id="sort-by"
                                    onchange="handleSortChange()"
                                    class="w-full p-2 border border-gray-300 rounded-lg focus-ring-2 focus-ring-primary-500 focus-border-primary-500">
                                <option value="created_at">جدیدترین</option>
                                <option value="-created_at">قدیمی‌ترین</option>
                                <option value="funding_percentage">کمترین پیشرفت</option>
                                <option value="-funding_percentage">بیشترین پیشرفت</option>
                                <option value="predicted_profit_rate">کمترین سود</option>
                                <option value="-predicted_profit_rate">بیشترین سود</option>
                                <option value="min_investment">کمترین سرمایه</option>
                                <option value="-min_investment">بیشترین سرمایه</option>
                            </select>
                        </div>
                    </div>

                    <!-- Projects Grid -->
                    <div class="flex-1">
                        <div id="loading-section" class="min-h-screen bg-gray-50 py-8">
                            <div class="max-w-7xl mx-auto px-4">
                                <div class="animate-pulse">
                                    <div class="h-8 bg-gray-200 rounded w-1/4 mb-8"></div>
                                    <div class="grid grid-cols-1 md-grid-cols-2 lg-grid-cols-3 gap-6">
                                        <div class="bg-white rounded-xl p-6">
                                            <div class="h-48 bg-gray-200 rounded-lg mb-4"></div>
                                            <div class="h-4 bg-gray-200 rounded mb-2"></div>
                                            <div class="h-4 bg-gray-200 rounded w-3/4 mb-4"></div>
                                            <div class="h-2 bg-gray-200 rounded mb-4"></div>
                                            <div class="h-10 bg-gray-200 rounded"></div>
                                        </div>
                                        <div class="bg-white rounded-xl p-6">
                                            <div class="h-48 bg-gray-200 rounded-lg mb-4"></div>
                                            <div class="h-4 bg-gray-200 rounded mb-2"></div>
                                            <div class="h-4 bg-gray-200 rounded w-3/4 mb-4"></div>
                                            <div class="h-2 bg-gray-200 rounded mb-4"></div>
                                            <div class="h-10 bg-gray-200 rounded"></div>
                                        </div>
                                        <div class="bg-white rounded-xl p-6">
                                            <div class="h-48 bg-gray-200 rounded-lg mb-4"></div>
                                            <div class="h-4 bg-gray-200 rounded mb-2"></div>
                                            <div class="h-4 bg-gray-200 rounded w-3/4 mb-4"></div>
                                            <div class="h-2 bg-gray-200 rounded mb-4"></div>
                                            <div class="h-10 bg-gray-200 rounded"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="projects-section" style="display: none;">
                            <div id="no-projects-message" class="bg-white rounded-lg shadow-sm p-12 text-center" style="display: none;">
                                <div class="text-6xl mb-4">🔍</div>
                                <h3 class="text-xl font-semibold text-gray-900 mb-2">
                                    پروژه‌ای یافت نشد
                                </h3>
                                <p class="text-gray-600 mb-6">
                                    با فیلترهای انتخابی شما هیچ پروژه‌ای یافت نشد
                                </p>
                                <button onclick="clearFilters()" class="btn btn-outline">
                                    حذف فیلترها
                                </button>
                            </div>

                            <div id="projects-grid" class="grid grid-cols-1 md-grid-cols-2 lg-grid-cols-3 gap-6">
                                <!-- Projects will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // داده‌های فیک برای پروژه‌ها
        const sampleProjects = [
            {
                id: 1,
                name: "سی تی اسکن 64 اسلایس",
                short_description: "سرمایه‌گذاری در دستگاه سی تی اسکن پیشرفته برای بیمارستان تخصصی",
                status: "active",
                is_featured: true,
                funding_percentage: 75,
                predicted_profit_rate: 22.5,
                project_duration: 36,
                city: "تهران",
                shares_sold: 1800,
                price_per_share: 850000,
                min_investment: 8500000,
                images: ["https://picsum.photos/400/300?random=1"],
                category_id: 1
            },
            {
                id: 2,
                name: "دستگاه ام آر آی 1.5 تسلا",
                short_description: "احداث مرکز تصویربرداری با دستگاه ام آر آی پیشرفته",
                status: "active",
                is_featured: false,
                funding_percentage: 45,
                predicted_profit_rate: 28.3,
                project_duration: 48,
                city: "مشهد",
                shares_sold: 1200,
                price_per_share: 1200000,
                min_investment: 12000000,
                images: ["https://picsum.photos/400/300?random=2"],
                category_id: 1
            },
            {
                id: 3,
                name: "لابراتوار دندانپزشکی دیجیتال",
                short_description: "تأسیس لابراتوار مدرن دندانپزشکی با تجهیزات دیجیتال",
                status: "funded",
                is_featured: true,
                funding_percentage: 100,
                predicted_profit_rate: 18.7,
                project_duration: 24,
                city: "اصفهان",
                shares_sold: 950,
                price_per_share: 650000,
                min_investment: 6500000,
                images: ["https://picsum.photos/400/300?random=3"],
                category_id: 2
            },
            {
                id: 4,
                name: "دستگاه سونوگرافی چهار بعدی",
                short_description: "خرید دستگاه سونوگرافی پیشرفته برای کلینیک تخصصی",
                status: "active",
                is_featured: false,
                funding_percentage: 32,
                predicted_profit_rate: 25.8,
                project_duration: 18,
                city: "شیراز",
                shares_sold: 750,
                price_per_share: 450000,
                min_investment: 4500000,
                images: ["https://picsum.photos/400/300?random=4"],
                category_id: 1
            },
            {
                id: 5,
                name: "مرکز فیزیوتراپی ورزشی",
                short_description: "احداث مرکز تخصصی فیزیوتراپی با تجهیزات مدرن",
                status: "completed",
                is_featured: false,
                funding_percentage: 100,
                predicted_profit_rate: 16.2,
                project_duration: 30,
                city: "تبریز",
                shares_sold: 1100,
                price_per_share: 380000,
                min_investment: 3800000,
                images: ["https://picsum.photos/400/300?random=5"],
                category_id: 3
            },
            {
                id: 6,
                name: "دستگاه آنژیوگرافی دیجیتال",
                short_description: "خرید دستگاه آنژیوگرافی برای بیمارستان قلب",
                status: "active",
                is_featured: true,
                funding_percentage: 68,
                predicted_profit_rate: 32.1,
                project_duration: 42,
                city: "تهران",
                shares_sold: 1600,
                price_per_share: 1500000,
                min_investment: 15000000,
                images: ["https://picsum.photos/400/300?random=6"],
                category_id: 1
            },
            {
                id: 7,
                name: "کلینیک لیزر چشم",
                short_description: "تأسیس کلینیک تخصصی لیزر و زیبایی چشم",
                status: "active",
                is_featured: false,
                funding_percentage: 55,
                predicted_profit_rate: 29.4,
                project_duration: 36,
                city: "کرج",
                shares_sold: 1300,
                price_per_share: 950000,
                min_investment: 9500000,
                images: ["https://picsum.photos/400/300?random=7"],
                category_id: 4
            },
            {
                id: 8,
                name: "دستگاه پت اسکن",
                short_description: "خرید دستگاه پت اسکن برای مرکز تصویربرداری هسته‌ای",
                status: "active",
                is_featured: true,
                funding_percentage: 82,
                predicted_profit_rate: 35.7,
                project_duration: 60,
                city: "مشهد",
                shares_sold: 2000,
                price_per_share: 2200000,
                min_investment: 22000000,
                images: ["https://picsum.photos/400/300?random=8"],
                category_id: 1
            }
        ];

        const sampleCategories = [
            { id: 1, name: "تجهیزات تصویربرداری" },
            { id: 2, name: "تجهیزات دندانپزشکی" },
            { id: 3, name: "تجهیزات فیزیوتراپی" },
            { id: 4, name: "تجهیزات لیزر" },
            { id: 5, name: "تجهیزات آزمایشگاهی" }
        ];

        // وضعیت برنامه
        let state = {
            projects: [],
            categories: [],
            viewMode: 'grid',
            searchQuery: '',
            selectedCategory: null,
            sortBy: 'created_at',
            loading: true
        };

        // تابع فرمت ارز
        function formatCurrency(amount) {
            return new Intl.NumberFormat('fa-IR').format(amount) + ' ریال';
        }

        // تابع فرمت درصد
        function formatPercentage(percentage) {
            return Math.round(percentage) + '%';
        }

        // تابع وضعیت پروژه
        function getStatusBadge(status) {
            const statusMap = {
                active: { variant: 'success', text: 'فعال' },
                funded: { variant: 'primary', text: 'تکمیل شده' },
                completed: { variant: 'secondary', text: 'پایان یافته' },
                cancelled: { variant: 'danger', text: 'لغو شده' },
            };
            return statusMap[status] || { variant: 'secondary', text: status };
        }

        // تابع بارگذاری پروژه‌ها
        function loadProjects() {
            state.loading = true;
            updateUI();

            // شبیه‌سازی بارگذاری از API
            setTimeout(() => {
                let filteredProjects = [...sampleProjects];

                // فیلتر بر اساس دسته‌بندی
                if (state.selectedCategory) {
                    filteredProjects = filteredProjects.filter(project =>
                        project.category_id === state.selectedCategory
                    );
                }

                // فیلتر بر اساس جستجو
                if (state.searchQuery) {
                    const query = state.searchQuery.toLowerCase();
                    filteredProjects = filteredProjects.filter(project =>
                        project.name.toLowerCase().includes(query) ||
                        project.short_description.toLowerCase().includes(query) ||
                        project.city.toLowerCase().includes(query)
                    );
                }

                // مرتب‌سازی
                filteredProjects.sort((a, b) => {
                    switch (state.sortBy) {
                        case 'created_at':
                            return b.id - a.id;
                        case '-created_at':
                            return a.id - b.id;
                        case 'funding_percentage':
                            return a.funding_percentage - b.funding_percentage;
                        case '-funding_percentage':
                            return b.funding_percentage - a.funding_percentage;
                        case 'predicted_profit_rate':
                            return a.predicted_profit_rate - b.predicted_profit_rate;
                        case '-predicted_profit_rate':
                            return b.predicted_profit_rate - a.predicted_profit_rate;
                        case 'min_investment':
                            return a.min_investment - b.min_investment;
                        case '-min_investment':
                            return b.min_investment - a.min_investment;
                        default:
                            return 0;
                    }
                });

                state.projects = filteredProjects;
                state.loading = false;
                updateUI();
            }, 1000);
        }

        // تابع بارگذاری دسته‌بندی‌ها
        function loadCategories() {
            state.categories = sampleCategories;
            renderCategories();
        }

        // تابع رندر دسته‌بندی‌ها
        function renderCategories() {
            const categoriesList = document.getElementById('categories-list');
            categoriesList.innerHTML = '';

            state.categories.forEach(category => {
                const button = document.createElement('button');
                button.className = `w-full text-right p-2 rounded-lg text-sm transition-colors ${
                    state.selectedCategory === category.id
                        ? 'bg-primary-100 text-primary-700'
                        : 'text-gray-600 hover-bg-gray-100'
                }`;
                button.textContent = category.name;
                button.onclick = () => setSelectedCategory(category.id);
                categoriesList.appendChild(button);
            });
        }

        // تابع رندر پروژه‌ها
        function renderProjects() {
            const projectsGrid = document.getElementById('projects-grid');
            projectsGrid.innerHTML = '';

            state.projects.forEach(project => {
                const statusBadge = getStatusBadge(project.status);
                const badgeClass = {
                    'success': 'badge-success',
                    'primary': 'badge-primary',
                    'danger': 'badge-danger',
                    'secondary': 'badge-secondary'
                }[statusBadge.variant];

                const projectCard = document.createElement('div');
                projectCard.className = `card hover-shadow-md transition-shadow group ${
                    state.viewMode === 'list' ? 'flex' : ''
                }`;
                projectCard.innerHTML = `
                    <div class="${state.viewMode === 'list' ? 'w-1/3' : 'relative'}">
                        <div class="aspect-w-16 aspect-h-9 bg-gray-200 rounded-lg overflow-hidden mb-4">
                            ${project.images && project.images.length > 0 ?
                                `<img src="${project.images[0]}" alt="${project.name}" class="w-full h-48 object-cover group-hover-scale-105 transition-transform duration-300" />` :
                                `<div class="w-full h-48 bg-gradient-to-br from-blue-100 to-blue-200 flex items-center justify-center">
                                    <div class="text-6xl">🏥</div>
                                </div>`
                            }
                        </div>

                        ${project.is_featured ?
                            `<span class="badge badge-warning absolute top-2 right-2">
                                <i class="fas fa-star ml-1 text-xs"></i>
                                ویژه
                            </span>` : ''
                        }

                        <span class="badge ${badgeClass} absolute top-2 left-2">
                            ${statusBadge.text}
                        </span>
                    </div>

                    <div class="${state.viewMode === 'list' ? 'w-2/3' : ''} p-4">
                        <h3 class="text-lg font-semibold text-gray-900 mb-2 group-hover-text-primary-600 transition-colors">
                            ${project.name}
                        </h3>

                        <p class="text-gray-600 text-sm mb-4 line-clamp-2">
                            ${project.short_description}
                        </p>

                        <div class="space-y-3 mb-4">
                            <div>
                                <div class="flex justify-between items-center mb-1">
                                    <span class="text-sm font-medium text-gray-700">پیشرفت تأمین مالی</span>
                                    <span class="text-sm font-bold text-primary-600">
                                        ${formatPercentage(project.funding_percentage)}
                                    </span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div
                                        class="bg-gradient-to-r from-primary-500 to-primary-600 h-2 rounded-full transition-all duration-300"
                                        style="width: ${Math.min(project.funding_percentage, 100)}%">
                                    </div>
                                </div>
                            </div>

                            <div class="grid grid-cols-2 gap-3 text-sm">
                                <div class="flex items-center text-gray-600">
                                    <i class="fas fa-chart-line ml-1 text-sm"></i>
                                    <span>${formatPercentage(project.predicted_profit_rate)} سود</span>
                                </div>
                                <div class="flex items-center text-gray-600">
                                    <i class="fas fa-clock ml-1 text-sm"></i>
                                    <span>${project.project_duration} ماه</span>
                                </div>
                                <div class="flex items-center text-gray-600">
                                    <i class="fas fa-map-marker-alt ml-1 text-sm"></i>
                                    <span>${project.city}</span>
                                </div>
                                <div class="flex items-center text-gray-600">
                                    <i class="fas fa-users ml-1 text-sm"></i>
                                    <span>${project.shares_sold} سهم</span>
                                </div>
                            </div>
                        </div>

                        <div class="border-t border-gray-200 pt-4">
                            <div class="flex justify-between items-center mb-3">
                                <div>
                                    <div class="text-sm text-gray-500">قیمت هر سهم</div>
                                    <div class="text-lg font-bold text-gray-900">
                                        ${formatCurrency(project.price_per_share)}
                                    </div>
                                </div>
                                <div class="text-left">
                                    <div class="text-sm text-gray-500">حداقل سرمایه‌گذاری</div>
                                    <div class="text-lg font-bold text-primary-600">
                                        ${formatCurrency(project.min_investment)}
                                    </div>
                                </div>
                            </div>

                            <a href="/projects/${project.id}"
                               class="w-full btn btn-primary flex items-center justify-center">
                                مشاهده جزئیات
                                <i class="fas fa-arrow-left mr-2 text-sm"></i>
                            </a>
                        </div>
                    </div>
                `;

                projectsGrid.appendChild(projectCard);
            });
        }

        // تابع به‌روزرسانی UI
        function updateUI() {
            const loadingSection = document.getElementById('loading-section');
            const projectsSection = document.getElementById('projects-section');
            const noProjectsMessage = document.getElementById('no-projects-message');
            const projectsCount = document.getElementById('projects-count');

            if (state.loading) {
                loadingSection.style.display = 'block';
                projectsSection.style.display = 'none';
            } else {
                loadingSection.style.display = 'none';
                projectsSection.style.display = 'block';

                if (state.projects.length === 0) {
                    noProjectsMessage.style.display = 'block';
                    document.getElementById('projects-grid').style.display = 'none';
                } else {
                    noProjectsMessage.style.display = 'none';
                    document.getElementById('projects-grid').style.display = 'grid';
                    renderProjects();
                }

                projectsCount.textContent = `${state.projects.length} پروژه فعال برای سرمایه‌گذاری`;
            }

            // به‌روزرسانی دکمه‌های حالت نمایش
            const gridViewBtn = document.getElementById('grid-view-btn');
            const listViewBtn = document.getElementById('list-view-btn');

            gridViewBtn.className = `p-2 rounded-lg ${
                state.viewMode === 'grid'
                    ? 'bg-primary-100 text-primary-600'
                    : 'text-gray-400 hover-text-gray-600'
            }`;

            listViewBtn.className = `p-2 rounded-lg ${
                state.viewMode === 'list'
                    ? 'bg-primary-100 text-primary-600'
                    : 'text-gray-400 hover-text-gray-600'
            }`;

            // به‌روزرسانی دکمه همه دسته‌ها
            const allCategoriesBtn = document.getElementById('all-categories-btn');
            allCategoriesBtn.className = `w-full text-right p-2 rounded-lg text-sm transition-colors ${
                state.selectedCategory === null
                    ? 'bg-primary-100 text-primary-700'
                    : 'text-gray-600 hover-bg-gray-100'
            }`;

            // به‌روزرسانی مرتب‌سازی
            document.getElementById('sort-by').value = state.sortBy;
        }

        // تابع تغییر حالت نمایش
        function setViewMode(mode) {
            state.viewMode = mode;
            updateUI();
        }

        // تابع تغییر دسته‌بندی
        function setSelectedCategory(categoryId) {
            state.selectedCategory = categoryId;
            loadProjects();
            renderCategories();
        }

        // تابع جستجو
        function handleSearch() {
            state.searchQuery = document.getElementById('search-query').value;
            loadProjects();
        }

        // تابع تغییر مرتب‌سازی
        function handleSortChange() {
            state.sortBy = document.getElementById('sort-by').value;
            loadProjects();
        }

        // تابع پاک کردن فیلترها
        function clearFilters() {
            state.searchQuery = '';
            state.selectedCategory = null;
            document.getElementById('search-query').value = '';
            loadProjects();
            renderCategories();
        }

        // مقداردهی اولیه
        document.addEventListener('DOMContentLoaded', function() {
            loadCategories();
            loadProjects();
        });
    </script>
</body>
</html>